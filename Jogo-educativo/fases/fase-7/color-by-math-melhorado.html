<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Color by Math - Integra√ß√£o Completa</title>
  <style>
    body {
      background: linear-gradient(to right, #f0f8ff, #d1e0ff);
      font-family: 'Poppins', 'Fredoka', 'Quicksand', cursive, sans-serif;
      display: flex; flex-direction:column; align-items:center;
      padding: 30px;
      min-height: 100vh;
    }
    h1 {
      color: #1976d2;
      margin-bottom: 20px;
      letter-spacing: 0.04em;
      font-family:'Fredoka','Poppins',cursive,sans-serif;
      display:flex;align-items:center;
    }
    h1::before {
      content: '‚úèÔ∏è';
      font-size: 1.25em;
      margin-right: 8px;
    }
    #svgCanvas {
      border: 2px solid #aab8cf;
      background: radial-gradient(circle at 50% 50%, #fafdff 75%, #eaf4fb 100%);
      border-radius: 16px;
      margin-bottom: 18px;
      box-shadow:0 2px 14px rgba(160,185,230,0.09);
      transition: box-shadow .3s ease;
    }
    .palette {
      display: flex;
      flex-wrap: wrap;
      gap: 14px;
      margin: 20px 0 14px 0;
      justify-content:center;
    }
    .ball {
      width: 44px; height: 44px; border-radius: 50%;
      display: flex; align-items: center; justify-content: center;
      color: #fff; font-weight: bold; font-size:1.16em;
      cursor: grab;
      user-select: none;
      box-shadow: 0 3px 14px rgba(0,0,0,0.11);
      transition: transform .2s, box-shadow .2s;
      border: 2px solid #fff8;
    }
    .ball:hover {
      transform: scale(1.18);
      box-shadow: 0 8px 18px rgba(0,0,0,0.16);
      z-index:2;
    }
    .dragging {
      box-shadow: 0 0 28px #78cffa;
      transform: scale(1.22);
    }
    .area {
      transition: filter .25s, stroke .18s;
      cursor: pointer;
    }
    .area:hover {
      filter: brightness(1.22) drop-shadow(0 0 8px #4caefb);
      stroke: #1976d2;
      stroke-width:3;
    }
    .correct {
      filter: drop-shadow(0 0 14px #4caf50);
      stroke: #43a047;
      stroke-width:3;
    }
    .incorrect {
      filter: drop-shadow(0 0 12px #f44336);
      stroke: #d32f2f;
      stroke-width:3;
      animation: shake .2s;
    }
    @keyframes shake {
      0% { transform: translateX(0); }
      25% { transform: translateX(-7px); }
      50% { transform: translateX(7px); }
      75% { transform: translateX(-5px); }
      100% { transform: translateX(0); }
    }
    button {
      padding: 12px 28px; margin-top: 14px;
      background: linear-gradient(90deg,#43a047 40%,#1976d2 100%);
      color: #fff;
      border: none;
      border-radius: 18px;
      font-weight: bold;
      font-size: 1.1em;
      cursor: pointer;
      box-shadow: 0 2px 8px #d0eafc;
      transition:box-shadow .22s,transform .19s;
      outline: none;
    }
    button:hover {
      transform: scale(1.07);
      box-shadow: 0 7px 23px #b8e0fa;
    }
    .progress {
      margin-top:14px; font-weight:bold; color:#388e3c; font-size:1.2em;
    }
    .feedback {
      margin-top:10px;font-size:1.12em;font-family:'Fredoka',sans-serif;
      color:#1976d2;
      min-height:34px;
      text-align:center;
    }
  </style>
</head>
<body>
  <h1>Color by Math</h1>
  <svg id="svgCanvas" width="400" height="400" viewBox="0 0 400 400">
    <defs>
      <linearGradient id="grad1" x1="0" y1="0" x2="0" y2="1">
        <stop offset="0%" stop-color="#ffcccc"/>
        <stop offset="100%" stop-color="#ff9999"/>
      </linearGradient>
    </defs>
  </svg>

  <div class="palette" id="palette"></div>
  <div class="progress" id="progress"></div>
  <div class="feedback" id="feedback"></div>
  <button onclick="newChallenge()">Nova Pergunta</button>

  <script>
    const svg = document.getElementById('svgCanvas');
    const palette = document.getElementById('palette');
    const progressDiv = document.getElementById('progress');
    const feedbackDiv = document.getElementById('feedback');
    let areasData = [];
    let correctCount = 0;

    function randExpr() {
      const a = Math.ceil(Math.random()*10);
      const b = Math.ceil(Math.random()*10);
      const op = Math.random()<0.5? '+':'-';
      const res = op==='+'? a+b : a-b;
      if(res<1||res>10) return randExpr();
      return {expr:`${a}${op}${b}`, val:res};
    }

    function createAreas() {
      svg.innerHTML = '<defs><linearGradient id="grad1" x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stop-color="#ffcccc"/><stop offset="100%" stop-color="#ff9999"/></linearGradient></defs>';
      areasData=[];
      correctCount = 0;
      for(let i=0;i<10;i++){
        const {expr,val} = randExpr();
        const angle = (i/10)*Math.PI*2;
        const r=140;
        const x=200+Math.cos(angle)*r;
        const y=200+Math.sin(angle)*r;
        const polygon = document.createElementNS(svg.namespaceURI,'polygon');
        polygon.setAttribute('points',`${200},200 ${x},${y} ${200+Math.cos(angle+0.1)*r},${200+Math.sin(angle+0.1)*r}`);
        polygon.setAttribute('fill','url(#grad1)');
        polygon.setAttribute('stroke','#aaa');
        polygon.setAttribute('stroke-width','2');
        polygon.classList.add('area');
        polygon.dataset.val=val;
        polygon.dataset.id=i;
        svg.appendChild(polygon);

        const text = document.createElementNS(svg.namespaceURI,'text');
        let textX=(200 + x+ (200+Math.cos(angle+0.1)*r))/3;
        let textY=(200 + y+ (200+Math.sin(angle+0.1)*r))/3;
        const textBG = document.createElementNS(svg.namespaceURI,"rect");
        textBG.setAttribute("x",textX-22);
        textBG.setAttribute("y",textY-15);
        textBG.setAttribute("width","44");
        textBG.setAttribute("height","26");
        textBG.setAttribute("rx","7");
        textBG.setAttribute("fill","#fff8");
        svg.appendChild(textBG);
        text.setAttribute('x',textX);
        text.setAttribute('y',textY+9);
        text.setAttribute('font-size','17');
        text.setAttribute('font-weight','bold');
        text.setAttribute('fill','#1976d2');
        text.setAttribute('text-anchor','middle');
        text.textContent=expr;
        svg.appendChild(text);

        areasData.push({id:i,expr,val,el:polygon,filled:false});
      }
      updateProgress();
      feedbackDiv.textContent = "";
    }

    function createPalette() {
      palette.innerHTML='';
      for(let n=1;n<=10;n++){
        const div=document.createElement('div');
        div.className='ball';
        div.style.background=colorFor(n);
        div.textContent=n;
        div.draggable=true;
        div.addEventListener('dragstart',e=>{
          e.dataTransfer.setData('text/plain',n);
          div.classList.add('dragging');
        });
        div.addEventListener('dragend',e=>{
          div.classList.remove('dragging');
        });
        palette.appendChild(div);
      }
    }

    function colorFor(n){
      const colors=['#d32f2f','#f57c00','#fbc02d','#7cb342','#0097a7','#5e35b1','#d81b60','#8e24aa','#3949ab','#0277bd'];
      return colors[(n-1)%colors.length];
    }

    function setupDrops() {
      areasData.forEach(a=>{
        const el = a.el;
        el.addEventListener('dragover',e=>{e.preventDefault();});
        el.addEventListener('drop',e=>{
          e.preventDefault();
          const ans = parseInt(e.dataTransfer.getData('text/plain'));
          if(ans===a.val && !a.filled){
            el.setAttribute('fill',colorFor(ans));
            el.classList.add('correct');
            a.filled=true;
            correctCount++;
            updateProgress();
            feedbackDiv.textContent = "√ìtimo trabalho!";
            if(correctCount===10){
              setTimeout(()=>{
                feedbackDiv.textContent="üéâ Parab√©ns! Voc√™ completou o desafio.";
              },300);
            }
          } else {
            el.classList.add('incorrect');
            feedbackDiv.textContent = "Tente novamente!";
            setTimeout(()=>{ el.classList.remove('incorrect'); },800);
          }
        });
      });
    }

    function updateProgress(){
      progressDiv.textContent = `${correctCount}/10 √°reas preenchidas`;
    }

    function newChallenge(){
      createAreas();
      createPalette();
      setupDrops();
    }

    document.addEventListener('DOMContentLoaded',newChallenge);
  </script>
</body>
</html>
