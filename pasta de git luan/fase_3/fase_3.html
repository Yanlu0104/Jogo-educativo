<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Ábaco Suanpan - Com Limite</title>
  <script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family:'Comic Sans MS',cursive,sans-serif;
      background:linear-gradient(135deg,#e0f7fa,#bbdefb);
      color:#333; padding:30px;
      display:flex; flex-direction:column; align-items:center;
    }
    h1 {
      color:#5d4037; font-size:2.5rem; margin-bottom:20px;
      text-shadow:2px 2px 0 #ffd54f;
    }
    .container {
      background:rgba(255,255,255,0.95);
      border-radius:20px;
      box-shadow:0 10px 20px rgba(0,0,0,0.2);
      padding:20px;
      border:8px solid #5d4037;
    }
    .abaco-frame {
      display:flex; gap:60px; justify-content:center;
      background:#a1887f; border-radius:10px; padding:20px;
      box-shadow:0 5px 15px rgba(0,0,0,0.2);
    }
    .haste-container { display:flex; flex-direction:column; align-items:center; }
    .haste-label {
      color:white; font-weight:bold; font-size:1.5rem;
      text-shadow:1px 1px 0 #5d4037; margin-bottom:10px;
    }
    .haste {
      position:relative; width:80px; height:300px;
      background:linear-gradient(to right,#5d4037,#6d4c41,#5d4037);
      border-radius:8px; display:flex; flex-direction:column;
      justify-content:space-evenly; align-items:center;
      border:2px solid #222; /* ponto inicial e sinal reconstruídos */
      overflow:hidden;
      box-shadow:inset 0 0 15px rgba(0,0,0,0.3);
    }
    .barra-central {
      position:absolute; width:100%; height:6px; top:50%;
      background:#3e2723; transform:translateY(-50%);
    }
    .conta {
      width:60px; height:25px; border-radius:12px;
      display:flex; justify-content:center; align-items:center;
      color:white; font-weight:bold; cursor:grab; user-select:none;
      transition:transform 0.25s ease;
      z-index:2;
    }
    .conta.superior {
      background:linear-gradient(to bottom,#ff5252,#d32f2f);
      border:2px solid #b71c1c;
    }
    .conta.inferior {
      background:linear-gradient(to bottom,#42a5f5,#1976d2);
      border:2px solid #0d47a1;
    }
    .conta.ativa {
      box-shadow:0 6px 10px rgba(0,0,0,0.4);
    }
    .valor-total {
      font-size:2.2rem; margin-top:20px; text-align:center;
      color:#5d4037;
    }
    .haste-value {
      background:#5d4037; color:#ffd54f; padding:8px 15px;
      text-align:center; font-size:1.8rem; border-radius:10px;
      text-shadow:1px 1px 0 #3e2723;
    }
  </style>
</head>
<body>
  <h1>Ábaco Suanpan - Com Limite</h1>
  <div class="container">
    <div class="abaco-frame">
      <div class="haste-container" data-index="0">
        <div class="haste-label">Dezenas</div>
        <div class="haste">
          <div class="barra-central"></div>
          <div class="conta superior" data-pos="0">5</div>
          <div class="conta inferior" data-pos="1">1</div>
          <div class="conta inferior" data-pos="2">1</div>
          <div class="conta inferior" data-pos="3">1</div>
          <div class="conta inferior" data-pos="4">1</div>
        </div>
        <div class="haste-value" id="valor-dezenas">0</div>
      </div>
      <div class="haste-container" data-index="1">
        <div class="haste-label">Unidades</div>
        <div class="haste">
          <div class="barra-central"></div>
          <div class="conta superior" data-pos="0">5</div>
          <div class="conta inferior" data-pos="1">1</div>
          <div class="conta inferior" data-pos="2">1</div>
          <div class="conta inferior" data-pos="3">1</div>
          <div class="conta inferior" data-pos="4">1</div>
        </div>
        <div class="haste-value" id="valor-unidades">0</div>
      </div>
    </div>
    <div class="valor-total">Valor Total: <span id="valor-total">0</span></div>
  </div>

  <script>
    let matriz = [
      [0,0,0,0,0],
      [0,0,0,0,0]
    ];
    const VALORES = [5,1,1,1,1];
    const HASTES = document.querySelectorAll(".haste-container");
    const LIMITE_SUP = 0;
    const LIMITE_INF = -20;

    function moverContaAutomatico(hasteIndex, contaIndex, direcao) {
      if (direcao === 1 && matriz[hasteIndex][contaIndex] === 0) {
        matriz[hasteIndex][contaIndex] = 1;
      } else if (direcao === -1 && matriz[hasteIndex][contaIndex] === 1) {
        matriz[hasteIndex][contaIndex] = 0;
      }
      atualizarVisual();
      calcularValor();
    }

    function atualizarVisual() {
      HASTES.forEach((haste, hIndex) => {
        const contas = haste.querySelectorAll(".conta");
        contas.forEach((conta, cIndex) => {
          let destino = matriz[hIndex][cIndex] === 1 ? LIMITE_INF : LIMITE_SUP;
          conta.style.transform = `translateY(${destino}px)`;
          conta.classList.toggle('ativa', matriz[hIndex][cIndex] === 1);
        });
      });
    }

    function calcularValor() {
      let dezenas=0, unidades=0;
      matriz[0].forEach((v,i)=>{ if(v) dezenas += VALORES[i]; });
      matriz[1].forEach((v,i)=>{ if(v) unidades += VALORES[i]; });
      let total = dezenas*10 + unidades;
      document.getElementById("valor-dezenas").textContent = dezenas;
      document.getElementById("valor-unidades").textContent = unidades;
      document.getElementById("valor-total").textContent = total;
    }

    interact('.conta').draggable({
      listeners:{
        move:(event)=>{
          const contaEl = event.target;
          const hasteEl = contaEl.closest('.haste-container');
          const hasteIndex = parseInt(hasteEl.dataset.index);
          const contaIndex = parseInt(contaEl.dataset.pos);
          const tipo = contaEl.classList.contains('superior') ? 'superior':'inferior';
          const dif = tipo === 'superior'? 1 : 1;
          if (event.dy < 0) moverContaAutomatico(hasteIndex, contaIndex, +dif);
          else moverContaAutomatico(hasteIndex, contaIndex, -dif);
        }
      }
    });

    document.addEventListener("DOMContentLoaded",()=>{
      atualizarVisual();
      calcularValor();
    });
  </script>
</body>
</html>